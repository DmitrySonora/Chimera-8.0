# Руководство по конфигурации эмоционального модуля DeBERTa (PerceptionActor)

**Файл:** config/settings_emo.py

---

#### Модель и производительность
`EMOTION_MODEL_NAME` - название модели на HuggingFace (по умолчанию: "fyaronskiy/deberta-v1-base-russian-go-emotions"). Предобученная DeBERTa-v1 для русского языка. Поддерживает 28 категорий эмоций. Средний F1-score: 0.48

`EMOTION_MODEL_DEVICE` - устройство для выполнения (по умолчанию: "cpu"); "cpu" - использовать процессор; "cuda" - использовать GPU (автоматический fallback на CPU если недоступна). Рекомендация: GPU ускоряет анализ в 5-10 раз. Анализ одного текста: ~50ms на GPU, ~150ms на CPU

`EMOTION_MODEL_CACHE_DIR` - директория для кэширования загруженной модели (по умолчанию: "./emo/cache"). Модель загружается один раз и кэшируется (~400MB)

#### Параметры анализа

`EMOTION_CONFIDENCE_THRESHOLD` - общий порог уверенности для метрик (по умолчанию: 0.5). Используется для агрегированных метрик. Индивидуальные пороги для каждой эмоции заданы в коде

`EMOTION_MODEL_MAX_LENGTH` - максимальная длина текста в токенах (по умолчанию: 128). Ограничение модели DeBERTa. Тексты автоматически обрезаются

#### Логирование эмоций

`EMOTION_LOG_PREDICTIONS` - логировать ли предсказания эмоций (по умолчанию: True). Полезно для отладки и анализа работы. Может создавать много логов при высокой нагрузке

`EMOTION_LOG_THRESHOLD` - минимальная вероятность эмоции для логирования (по умолчанию: 0.3). Эмоции с вероятностью ниже не логируются. Снижает объем логов

`EMOTION_EMOJI_MAP` - маппинг эмоций на эмодзи для логов (словарь с 28 эмоциями)

#### Пороговые значения эмоций

`EMOTION_THRESHOLDS` - список пороговых значений для каждой из 28 эмоций. Порядок соответствует EMOTION_LABELS. Значения от 0.0 до 1.0. Чем выше порог, тем реже эмоция будет определяться

- Рекомендация: увеличить порог для 'neutral' (последний элемент) если она слишком часто доминирует

`EMOTION_LABELS` - список названий эмоций на английском. 28 эмоций в порядке индексов модели. Не изменять порядок!

`EMOTION_LABELS_RU` - словарь для перевода эмоций на русский. Используется для отображения в логах. Можно изменять переводы по желанию

---

## Интеграция эмоций с потоком сообщений

#### Основные параметры
`EMOTION_ANALYSIS_ENABLED` - включить автоматический анализ эмоций (по умолчанию: True). True - каждое сообщение анализируется на эмоции. False - анализ отключен (для экономии ресурсов)

`EMOTION_PEAK_THRESHOLD` - порог для генерации EmotionalPeakEvent (по умолчанию: 0.8). События высокой эмоциональности. Значения выше порога считаются эмоциональными пиками

`EMOTION_TEXT_PREVIEW_LENGTH` - длина превью текста в событиях (по умолчанию: 50). Сколько символов сохранять в событии. Для приватности полный текст не сохраняется