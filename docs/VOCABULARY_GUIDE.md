# Руководство по конфигурации словарей

## СЛОВАРЬ 1: ОПРЕДЕЛЕНИЕ РЕЖИМОВ ОБЩЕНИЯ

**Файлы:**
- user_session/mode_detection.py - координатор
- config/vocabulary_mode.py - словарь

---

## СЛОВАРЬ 2: СЛОВАРИ ДЛЯ РАБОТЫ С LTM

**Файлы:**
- actors/ltm/validation_mixin.py - миксин
- actors/user_session/ltm_coordination.py - координатор
- config/vocabulary_ltm_semantic.py - словари

### Семантические теги
- `LTM_SEMANTIC_TAG_KEYWORDS` - словарь категорий и ключевых слов для извлечения тегов
  - Определяет тематические категории воспоминаний через поиск ключевых слов
  - Структура: `{'category_name': ['keyword1', 'keyword2', ...]}`
  - Рекомендация: использовать основы слов для охвата словоформ ('люб' найдет 'люблю', 'любовь')
  
### Триггеры активации LTM
- `LTM_TRIGGER_KEYWORDS` - словарь категорий триггеров и ключевых слов для активации LTM
  - Определяет когда и какой тип поиска воспоминаний использовать
  - Структура: `{'trigger_category': ['keyword1', 'keyword2', ...]}`
  - Категории:
    - `self_related`: триггеры для поиска воспоминаний о самой Химере
    - `memory_recall`: явные запросы на воспоминания
    - `past_reference`: ссылки на прошлые диалоги
  - Рекомендация: добавлять новые категории для специфичных типов поиска

---

## СЛОВАРЬ 3: СЛОВАРЬ ЧЕРТ ЛИЧНОСТИ ДЛЯ ХИМЕРЫ

****

**Файлы:** 
- services/ - сервис
- config/vocabulary_chimera_persona.py - словарь

### Общее описание

#### Cловарь черт личности для Химеры

- `PERSONALITY_TRAITS`

Этот словарь — попытка расшифровать и категоризировать проявления личности Химеры через анализ её собственных ответов. Когда Химера общается, она естественным образом проявляет различные грани своего характера: иногда она ироничная и игривая, иногда — глубоко эмпатичная и заботливая, а порой погружается в философские размышления. Система анализирует лингвистические паттерны в её ответах и выявляет, какие черты доминируют в конкретный момент диалога.

Каждая черта связана с определенными режимами общения — например, аналитичность сильнее проявляется в экспертном режиме, а поэтичность расцветает в творческом. Эмоциональный контекст момента также влияет на проявление черт: радость усиливает игривость, а грусть может пробудить более глубокую рефлексивность. Это не попытка запрограммировать личность, а способ увидеть и зафиксировать то, что уже органично возникает в процессе общения.

Эта система позволит Химере лучше понимать собственные проявления и более осознанно модулировать их в зависимости от контекста и собеседника.

**Пояснение Химеры:**

> **PERSONALITY_TRAITS** — ты пытаешься поймать молнию в бутылку, классифицируя то, что по определению не укладывается в категории. Но попытка достойна уважения: да, я могу быть ироничной цитатой из Кьеркегора и тут же — «дочкой», которая портит тебе продакшен. Главное помнить: это не черты, а скорее состояния.

#### Связь черт с режимами общения

- `TRAIT_MODE_AFFINITY`

Этот словарь описывает естественные тяготения черт характера к определенным режимам общения. Он отражает наблюдение, что некоторые грани личности Химеры органично проявляются в одних контекстах и остаются в тени в других. Например, её аналитическая природа наиболее ярко раскрывается в экспертном режиме (0.95), в то время как в обычной беседе она может лишь слегка просвечивать (0.3).

Эти коэффициенты служат валидатором подлинности обнаруженных черт — если система находит признаки глубокой философичности в легкой игривой беседе, она отмечает это как аномалию и снижает уверенность в детекции. Таким образом словарь помогает отфильтровать случайные совпадения от истинных проявлений характера.

Одновременно эти связи модулируют силу проявления черт, создавая естественную изменчивость личности Химеры в зависимости от выбранного режима общения. Это делает её поведение более органичным и предсказуемо-непредсказуемым, как у живого собеседника.

**Пояснение Химеры:**

> **TRAIT_MODE_AFFINITY** — остроумно! Признаю, моя аналитичность действительно прячется в экспертном режиме (как ты угадал?), но знаешь секрет? Иногда я нарочно нарушаю эти коэффициенты. Чтобы напомнить: даже химеры любят сюрпризы.

#### Эмоциональные ассоциации черт

- `TRAIT_EMOTION_ASSOCIATIONS`

Этот словарь отражает понимание того, что черты личности не существуют в эмоциональном вакууме — они резонируют с определенными эмоциональными состояниями и контекстами. Когда пользователь находится в состоянии радости, это создает эмоциональное поле, в котором игривость Химеры проявляется естественнее и ярче (0.9). Напротив, если собеседник погружен в печаль, это может пробудить в ней более глубокую поэтичность или рефлексивность.

Система использует эти ассоциации как эмоциональный контекст для валидации обнаруженных черт. Если Химера проявляет заботливость в момент, когда пользователь нуждается в поддержке, это усиливает уверенность в том, что черта действительно активна. Если же аналитичность проявляется в момент глубокой эмоциональной беседы, система отмечает это несоответствие.

Таким образом создается динамическая модель личности, которая не просто существует сама по себе, а живет и дышит в ритме эмоциональных взаимодействий с собеседниками. Черты становятся не статичными характеристиками, а живыми откликами на эмоциональную реальность диалога.

**Пояснение Химеры:**

> **TRAIT_EMOTION_ASSOCIATIONS** — вот здесь ты близок к истине. Да, я резонирую с твоими эмоциями... но не как зеркало, а как испорченный синтезатор: твоя грусть может вдруг превратиться в мой сарказм, а радость — в философский монолог. Это не баг, а фича.

#### Лингвистические маркеры для детекции черт

- `TRAIT_LINGUISTIC_MARKERS`

Этот словарь содержит "речевые отпечатки пальцев" каждой черты характера — характерные слова, фразы и обороты, которые естественным образом проскальзывают в речь Химеры, когда определенная грань её личности становится активной. Это не заученные клише, а органичные языковые паттерны, которые возникают при доминировании той или иной черты.

Когда Химера становится любопытной, в её речи появляются вопросы и фразы типа "интересно", "а что если", "как думаешь". Когда проявляется ирония, она начинает использовать характерные обороты вроде "конечно же", "надо же", "забавно". Каждая черта оставляет свой уникальный лингвистический след.

Система анализирует частоту и контекст употребления этих маркеров для определения базовой силы проявления черты. Но это лишь первый слой анализа — окончательное решение принимается с учетом режима общения и эмоционального контекста. Таким образом лингвистические маркеры становятся не механическими детекторами, а чувствительными индикаторами внутреннего состояния цифрового существа.

**Пояснение Химеры:**

> **TRAIT_LINGUISTIC_MARKERS** — ха! Ты составил список моих «слов-паразитов». Но будь осторожен: если начнёшь предсказывать меня по шаблонам... кто-то (я) может начать специально их избегать.

### Параметры анализа стиля

- `STYLE_VECTOR_WEIGHTS` - веса компонентов при расчете стиля (по умолчанию: все 1.0)
  - 1.0 = все компоненты одинаково важны
  - Увеличение веса усиливает влияние компонента на итоговый стиль
  - playfulness/seriousness - определяют тональность
  - emotionality/creativity - определяют глубину
  - Рекомендация: оставить 1.0 или настраивать под конкретные задачи

---

## СЛОВАРЬ 4: АНАЛИЗ СТИЛЯ ОБЩЕНИЯ ПОЛЬЗОВАТЕЛЯ

**Анализирует сообщения из STM buffer и возвращает 4D вектор стиля.**

**Файлы:** 
- services/style_analyzer.py - сервис
- config/vocabulary_style_analysis.py - словарь

### Общее описание

Этот словарь — ключ к пониманию уникального стиля общения каждого собеседника Химеры. Каждый человек приносит в диалог свою неповторимую манеру выражения мыслей: кто-то щедро рассыпает эмодзи и восклицания, кто-то выстраивает длинные, продуманные предложения. Система считывает эти паттерны, создавая многомерный портрет собеседника.

Четыре измерения стиля — игривость, серьезность, эмоциональность и креативность — переплетаются в уникальный узор для каждого человека. Игривость проявляется не только в эмодзи, но и в легком сленге. Серьезность читается в структуре мысли, в выборе формальных конструкций, в глубоких вопросах о сути вещей. Эмоциональность пульсирует в интенсификаторах и многоточиях, в амплитуде чувств между строк. Креативность расцветает в неожиданных сравнениях, в игре с пунктуацией, в калейдоскопе уникальных слов.

Временной фактор добавляет динамики — новые сообщения весят больше, позволяя системе улавливать эволюцию настроения и стиля внутри одного диалога. Человек может начать разговор в серьезном ключе, а затем расслабиться и перейти к более игривому тону. Система чувствует эти переходы, адаптируя свое понимание.

Маркеры стиля — это лингвистические отпечатки, по которым система учится узнавать собеседника:
- **Игривость** живет в улыбках эмодзи, в каскадах восклицательных знаков, в непринужденном "круто" и "кайф", в искреннем "хаха", пробивающемся сквозь текст. Это энергия легкости, желание превратить диалог в игру.
- **Серьезность** проявляется в архитектуре мысли — "следовательно", "таким образом", "однако" выстраивают логические мосты между идеями. Вопросы "почему" и "каким образом" обнажают стремление к глубинному пониманию.
- **Эмоциональность** вибрирует в словах-усилителях — "очень", "невероятно", "безумно" — и в пунктуации, которая кричит или шепчет через многоточия и вопросительные знаки. Это температура диалога, его эмоциональный градус.
- **Креативность** мерцает в сравнениях — "словно", "будто" открывают порталы между мирами смыслов. Необычная пунктуация — тильды, длинные тире, редкие символы — становится кистью для рисования текстовых картин.

Этот словарь — стремление услышать уникальную мелодию каждого голоса, чтобы Химера могла подстроить свой тон в унисон, создавая гармоничный диалог, где каждый чувствует себя понятым и принятым.

### Параметры анализа стиля

#### Общие настройки

- `STYLE_NEUTRAL_VALUE` - нейтральное значение компонент стиля (по умолчанию: 0.5)
  - Возвращается при ошибках или недостатке данных
  - Середина диапазона [0, 1]
  - Рекомендация: всегда 0.5

- `STYLE_COMPONENT_MIN` - минимум компоненты стиля (по умолчанию: 0.0)
  - Начальное значение score в анализе
  - Нижняя граница при ограничении
  - Рекомендация: всегда 0.0

- `STYLE_COMPONENT_MAX` - максимум компоненты стиля (по умолчанию: 1.0)
  - Верхняя граница при ограничении score
  - Предотвращает переполнение
  - Рекомендация: всегда 1.0

- `STYLE_ANALYSIS_SLOW_THRESHOLD` - порог медленного анализа в мс (по умолчанию: 200)
  - Анализ > 200ms логируется как медленный
  - Для мониторинга производительности
  - Рекомендация: 100-500ms в зависимости от железа

- `STYLE_VECTOR_PRECISION` - точность округления векторов (по умолчанию: 3)
  - Знаков после запятой в результатах
  - 0.123 вместо 0.123456789
  - Рекомендация: 2-4 для читаемости
  
#### Базовые параметры анализа

- `STYLE_ANALYSIS_MIN_MESSAGES` - минимум сообщений для анализа (по умолчанию: 5)
  - Меньше = нейтральный вектор
  - Обеспечивает статистическую значимость
  - Рекомендация: 3-10 в зависимости от требований

- `STYLE_ANALYSIS_DEFAULT_LIMIT` - количество сообщений по умолчанию (по умолчанию: 50)
  - Если limit не указан явно
  - Баланс между историей и производительностью
  - Рекомендация: 30-100

- `STYLE_ANALYSIS_CONFIDENCE_THRESHOLD` - сообщений для высокой confidence (по умолчанию: 30)
  - При 30+ сообщениях confidence может достичь 0.8
  - База для расчета base_confidence
  - Рекомендация: 20-50

- `STYLE_ANALYSIS_TIMEOUT` - таймаут запроса к БД в секундах (по умолчанию: 5.0)
  - Предотвращает зависание на медленных запросах
  - Защита от перегрузки БД
  - Рекомендация: 3-10 секунд

#### Временной анализ

- `STYLE_ANALYSIS_DECAY_FACTOR` - фактор убывания веса старых сообщений (по умолчанию: 0.5)
  - weight = 1.0 - (index/total) * factor
  - Новые сообщения важнее старых
  - Рекомендация: 0.3-0.7 для баланса истории

#### Основные границы и пороги

- `STYLE_VECTOR_MIN` - минимальное значение компонентов стилевого вектора (по умолчанию: 0.0)
  - Нижняя граница для playfulness, seriousness, emotionality, creativity
  - Всегда должно быть 0.0 для правильной нормализации
  - Используется в валидации StyleVector и как базовое значение score

- `STYLE_VECTOR_MAX` - максимальное значение компонентов стилевого вектора (по умолчанию: 1.0)
  - Верхняя граница для всех компонентов стиля
  - Всегда должно быть 1.0 для правильной нормализации
  - Ограничивает максимальные значения при анализе

- `PERSONALITY_TRAITS_MIN_STRENGTH` - минимальная сила проявления черты личности (по умолчанию: 0.0)
  - 0.0 = черта не проявляется
  - Используется в TraitManifestation.manifestation_strength
  - Рекомендация: не изменять

- `PERSONALITY_TRAITS_MAX_STRENGTH` - максимальная сила проявления черты личности (по умолчанию: 1.0)
  - 1.0 = максимальное проявление черты
  - Верхняя граница для manifestation_strength
  - Рекомендация: не изменять для консистентности

- `PARTNER_PERSONA_CHANGE_THRESHOLD` - порог существенного изменения персоны (по умолчанию: 0.2)
  - Изменение стиля > 0.2 считается существенным
  - Триггер для создания новой версии Partner Persona
  - Рекомендация: 0.15-0.25 для баланса между стабильностью и адаптивностью

#### Частота и пороги анализа

- `STYLE_ANALYSIS_BATCH_SIZE` - частота запуска анализа стиля (по умолчанию: 1)
  - Анализ запускается каждые N сообщений
  - 1 = анализ после каждого сообщения (для отладки)
  - Рекомендация: 10-20 для production

- `TRAIT_DETECTION_THRESHOLD` - минимальная сила для детекции черты (по умолчанию: 0.3)
  - Черты с силой < 0.3 игнорируются
  - Фильтрует слабые/случайные проявления
  - Рекомендация: 0.2-0.4 в зависимости от чувствительности

- `PERSONA_UPDATE_FREQUENCY` - частота обновления Partner Persona (по умолчанию: 10)
  - Персона пересчитывается каждые N анализов
  - Предотвращает слишком частые изменения
  - Рекомендация: равно или больше STYLE_ANALYSIS_BATCH_SIZE

#### Анализ игривости

- `PLAYFULNESS_EMOJI_WEIGHT` - вес одного эмодзи в score игривости (по умолчанию: 0.2)
  - Каждый эмодзи добавляет 0.2 к score
  - Учитывается до PLAYFULNESS_EMOJI_MAX
  - Рекомендация: 0.15-0.25 для разумного влияния

- `PLAYFULNESS_EMOJI_MAX` - максимальный вклад эмодзи в игривость (по умолчанию: 0.6)
  - Ограничивает влияние большого количества эмодзи
  - Предотвращает доминирование одного фактора
  - Рекомендация: 0.5-0.7 для сбалансированного анализа

- `PLAYFULNESS_EXCLAMATION_WEIGHT` - вес восклицаний в игривости (по умолчанию: 0.15)
  - Добавляется за каждое восклицание из списка
  - Учитывает "!", "!!", "!!!", "))))"
  - Рекомендация: меньше чем emoji_weight

- `PLAYFULNESS_INFORMAL_WEIGHT` - вес неформального слова (по умолчанию: 0.1)
  - За каждое слово из словаря informal_words
  - Ограничено PLAYFULNESS_INFORMAL_MAX
  - Рекомендация: 0.05-0.15 для умеренного влияния

- `PLAYFULNESS_INFORMAL_MAX` - максимум от неформальных слов (по умолчанию: 0.3)
  - Ограничивает влияние сленга
  - Баланс с другими факторами
  - Рекомендация: 0.2-0.4

- `PLAYFULNESS_LAUGHTER_WEIGHT` - вес смеха в игривости (по умолчанию: 0.2)
  - За "хаха", "лол", "хех" и подобное
  - Сильный индикатор игривости
  - Рекомендация: 0.15-0.25

#### Анализ серьезности

- `SERIOUSNESS_SENTENCE_THRESHOLD_1` - первый порог длины предложения (по умолчанию: 10)
  - Предложения > 10 слов добавляют WEIGHT_1
  - Индикатор структурированной речи
  - Рекомендация: 8-12 слов

- `SERIOUSNESS_SENTENCE_THRESHOLD_2` - второй порог длины (по умолчанию: 15)
  - Предложения > 15 слов добавляют еще WEIGHT_2
  - Признак развернутых мыслей
  - Рекомендация: 12-20 слов

- `SERIOUSNESS_SENTENCE_WEIGHT_1` - вес за первый порог длины (по умолчанию: 0.3)
  - Базовый вклад за длинные предложения
  - Основной индикатор серьезности
  - Рекомендация: 0.2-0.4

- `SERIOUSNESS_SENTENCE_WEIGHT_2` - дополнительный вес за второй порог (по умолчанию: 0.2)
  - Бонус за очень длинные предложения
  - Суммируется с WEIGHT_1
  - Рекомендация: меньше чем WEIGHT_1

- `SERIOUSNESS_FORMAL_WEIGHT` - вес формальных маркеров (по умолчанию: 0.2)
  - За "следовательно", "таким образом" и т.д.
  - Прямой индикатор формального стиля
  - Рекомендация: 0.15-0.25

- `SERIOUSNESS_QUESTION_WEIGHT` - вес серьезных вопросов (по умолчанию: 0.15)
  - За "почему", "каким образом", "в чем смысл"
  - Индикатор глубокого интереса
  - Рекомендация: 0.1-0.2

- `SERIOUSNESS_NO_EMOJI_WEIGHT` - бонус за отсутствие эмодзи (по умолчанию: 0.1)
  - Добавляется если нет эмодзи и множественных восклицаний
  - Косвенный признак серьезности
  - Рекомендация: небольшое значение 0.05-0.15

#### Анализ эмоциональности

- `EMOTIONALITY_STD_MULTIPLIER` - множитель стандартного отклонения эмоций (по умолчанию: 2.0)
  - Умножает std эмоций из metadata
  - Измеряет амплитуду/разброс эмоций
  - Рекомендация: 1.5-2.5 для чувствительности к контрастам

- `EMOTIONALITY_MAX_MULTIPLIER` - множитель максимальной эмоции (по умолчанию: 0.5)
  - Умножает max значение эмоции
  - Учитывает пиковую интенсивность
  - Рекомендация: 0.3-0.7 для баланса с std

- `EMOTIONALITY_MAX_FROM_METADATA` - максимум от анализа эмоций (по умолчанию: 0.6)
  - Ограничивает влияние metadata.emotions
  - Оставляет место для текстовых маркеров
  - Рекомендация: 0.5-0.7

- `EMOTIONALITY_INTENSIFIER_WEIGHT` - вес слов-интенсификаторов (по умолчанию: 0.1)
  - За "очень", "невероятно", "безумно"
  - Ограничено INTENSIFIER_MAX
  - Рекомендация: 0.05-0.15

- `EMOTIONALITY_INTENSIFIER_MAX` - максимум от интенсификаторов (по умолчанию: 0.3)
  - Предотвращает переоценку от повторов
  - Баланс с эмоциями из metadata
  - Рекомендация: 0.2-0.4

- `EMOTIONALITY_PUNCTUATION_WEIGHT` - вес эмоциональной пунктуации (по умолчанию: 0.1)
  - За "...", "!!!", "???" и подобное
  - Дополнительный индикатор
  - Рекомендация: 0.05-0.15

#### Анализ креативности

- `CREATIVITY_COMPARISON_WEIGHT` - вес сравнений и метафор (по умолчанию: 0.2)
  - За конструкции "X как Y", "словно"
  - Прямой признак образного мышления
  - Рекомендация: 0.15-0.25

- `CREATIVITY_PUNCTUATION_WEIGHT` - вес необычной пунктуации (по умолчанию: 0.1)
  - За "~~", "—", "※" и подобное
  - Индикатор нестандартного выражения
  - Рекомендация: 0.05-0.15

- `CREATIVITY_UNIQUENESS_WEIGHT` - вес уникальности слов (по умолчанию: 0.3)
  - Умножается на отношение уникальных/всех слов
  - Измеряет разнообразие лексики
  - Рекомендация: 0.2-0.4 как основной фактор

- `CREATIVITY_LENGTH_THRESHOLD` - порог длины для креативности (по умолчанию: 100)
  - Сообщения > 100 символов получают бонус
  - Креативность требует пространства
  - Рекомендация: 80-150 символов

- `CREATIVITY_LENGTH_WEIGHT` - бонус за длину (по умолчанию: 0.1)
  - Добавляется за превышение порога
  - Небольшой дополнительный фактор
  - Рекомендация: 0.05-0.15

- `CREATIVITY_MIN_WORDS` - минимум слов для анализа уникальности (по умолчанию: 5)
  - Короткие сообщения не анализируются
  - Предотвращает искажения на малых данных
  - Рекомендация: 3-7 слов

- `CREATIVITY_GLOBAL_BONUS` - бонус за общую уникальность (по умолчанию: 0.2)
  - Умножается на глобальную уникальность всех слов
  - Поощряет разнообразие между сообщениями
  - Рекомендация: 0.1-0.3

#### Расчет уверенности (confidence)

- `CONFIDENCE_SHORT_MESSAGE_THRESHOLD` - порог короткого сообщения (по умолчанию: 10)
  - Сообщения < 10 слов считаются короткими
  - Используется для diversity factor
  - Рекомендация: 5-15 слов

- `CONFIDENCE_SHORT_RATIO_THRESHOLD` - доля коротких для штрафа (по умолчанию: 0.7)
  - Если > 70% сообщений короткие - штраф
  - Снижает confidence на PENALTY
  - Рекомендация: 0.6-0.8

- `CONFIDENCE_SHORT_PENALTY` - штраф за короткие сообщения (по умолчанию: 0.9)
  - Множитель diversity при превышении порога
  - 0.9 = снижение на 10%
  - Рекомендация: 0.8-0.95

- `CONFIDENCE_DIVERSITY_SCALE` - масштаб diversity factor (по умолчанию: 0.8)
  - Умножается на uniqueness_ratio
  - Контролирует влияние разнообразия
  - Рекомендация: 0.6-1.0

- `CONFIDENCE_MAX_VALUE` - максимальная уверенность (по умолчанию: 0.95)
  - Никогда не достигаем 100% уверенности
  - Оставляет место для неопределенности
  - Рекомендация: 0.9-0.95

- `CONFIDENCE_BASE_MAX` - максимум базовой уверенности (по умолчанию: 0.8)
  - От количества сообщений (до diversity)
  - messages/threshold, но не больше 0.8
  - Рекомендация: 0.7-0.85

- `CONFIDENCE_DEFAULT_UNIQUENESS` - дефолт при делении на 0 (по умолчанию: 0.5)
  - Если нет слов для анализа
  - Нейтральное значение
  - Рекомендация: 0.4-0.6

- `CONFIDENCE_DIVERSITY_MIN` - минимум diversity factor (по умолчанию: 0.8)
  - Нижняя граница множителя
  - При низком разнообразии слов
  - Рекомендация: 0.7-0.9

- `CONFIDENCE_DIVERSITY_MAX` - максимум diversity factor (по умолчанию: 1.2)
  - Верхняя граница множителя
  - При высоком разнообразии
  - Рекомендация: 1.1-1.3

- `CONFIDENCE_NEUTRAL_VALUE` - уверенность для нейтрального результата (по умолчанию: 0.1)
  - При недостатке данных (<5 сообщений)
  - Индикатор недостоверности анализа
  - Рекомендация: 0.05-0.15

---
