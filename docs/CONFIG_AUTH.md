# Руководство по конфигурации модуля авторизации (AuthActor)

**Файл:** config/settings_auth.py

---

## AUTH ACTOR SETTINGS

`AUTH_SCHEMA_CHECK_TIMEOUT` - таймаут проверки существования таблиц авторизации в секундах. Защищает от зависания при проблемах с БД
- Для разработки: 5.0, для продакшн: 3.0

`AUTH_CLEANUP_INTERVAL` - интервал очистки старых данных авторизации в секундах (по умолчанию: 3600 = 1 час). Очищает старые записи из auth_attempts. Удаляет истекшие блокировки из blocked_users. 0 - для отключения очистки
- Для разработки: 300 (5 минут), для продакшн: 3600 (1 час)

`AUTH_METRICS_LOG_INTERVAL` - интервал логирования метрик AuthActor в секундах (по умолчанию: 300 = 5 минут). Выводит статистику проверок лимитов и авторизаций. Показывает процент успешных авторизаций. 0 - для отключения периодических метрик
- Для разработки: 60 (1 минута), для продакшн: 300 (5 минут)

---

## AUTHORIZATION SETTINGS

`PASSWORD_DURATIONS` - список допустимых сроков действия паролей в днях (по умолчанию: [30, 90, 180, 365]). Используется при создании новых паролей администратором. Проверяется при валидации в Pydantic моделях

#### Anti-bruteforce защита
`AUTH_MAX_ATTEMPTS` - количество неудачных попыток авторизации до блокировки (по умолчанию: 5)

`AUTH_BLOCK_DURATION` - длительность блокировки пользователя в секундах (по умолчанию: 900 = 15 минут)

`AUTH_ATTEMPTS_WINDOW` - окно времени для подсчета неудачных попыток в секундах (по умолчанию: 900 = 15 минут). Попытки старше этого времени не учитываются при подсчете. Должно быть равно или больше AUTH_BLOCK_DURATION

#### Администрирование
`ADMIN_USER_IDS` - список telegram_id пользователей с правами администратора (по умолчанию: [502312936]). Только эти пользователи могут использовать админские команды. Добавляйте ID через запятую: [502312936, 123456789]

#### Таймауты и лимиты
`AUTH_CHECK_TIMEOUT` - таймаут ожидания ответа от AuthActor при проверке лимитов (по умолчанию: 2.0 секунды)

`AUTH_FALLBACK_TO_DEMO` - разрешить работу в демо-режиме если AuthActor недоступен (по умолчанию: True). True = при недоступности AuthActor пользователи работают с демо-лимитами. False = при недоступности AuthActor доступ блокируется

`AUTH_PASSWORD_WAIT_TIMEOUT` - таймаут ожидания пароля после команды /auth в секундах (по умолчанию: 60). После этого времени состояние ожидания автоматически сбрасывается. Рекомендация: 30-120 секунд

#### Периодическая очистка лимитов

`AUTH_DAILY_RESET_ENABLED` - включить ежедневный сброс счетчиков (по умолчанию: True)

`AUTH_DAILY_RESET_HOUR` - час сброса в UTC (по умолчанию: 0)

#### Circuit Breaker для защиты от брутфорса

`AUTH_CIRCUIT_BREAKER_ENABLED` - включить Circuit Breaker для AUTH_REQUEST (по умолчанию: True)

`AUTH_CIRCUIT_BREAKER_THRESHOLD` - количество ошибок для открытия (по умолчанию: 3)

`AUTH_CIRCUIT_BREAKER_TIMEOUT` - время восстановления в секундах (по умолчанию: 300)
